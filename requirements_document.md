# 玄学AI智能体项目需求文档

## 项目概述

本项目是一个基于传统命理学与现代AI技术的智能预测系统，集成缘分居国学API和DeepSeek大语言模型，为用户提供专业的八字命理分析和人生指导。系统采用Streamlit构建现代化Web界面，支持多种预测类型和个性化分析。

## 项目特点

### 核心特色

1. **专业八字分析**
   - 集成缘分居国学API，提供准确的八字计算和分析
   - 四柱八字、十神关系、格局分析
   - 大运流年、用神喜忌计算

2. **AI智能预测**
   - 使用DeepSeek大语言模型生成个性化命理解读
   - 支持多种LLM提供商（DeepSeek、OpenAI等）
   - 可配置的模型参数和系统提示词

3. **多维度分析**
   - 综合运势：全面的命理分析和人生指导
   - 事业发展：职业规划和财运分析
   - 感情婚姻：感情运势和婚姻建议

4. **现代化界面**
   - 基于Streamlit构建的美观易用Web界面
   - 响应式设计，支持多设备访问
   - 分级下拉框选择出生地，提升用户体验

5. **数据安全**
   - 完善的数据验证和隐私保护机制
   - 用户数据不持久化存储
   - 严格的输入数据验证和清理

## 功能需求

### 核心功能

1. **用户信息管理**
   - 基本信息：姓名、性别
   - 出生时间：年、月、日、时、分（精确到分钟）
   - 出生地点：省份和城市的分级选择
   - 咨询问题：可选的具体咨询内容

2. **八字分析服务**
   - 调用缘分居国学API获取专业八字数据
   - 四柱八字信息展示
   - 十神关系和格局分析
   - 大运流年信息

3. **AI预测生成**
   - 基于API返回的八字数据构建提示词
   - 结合用户问题调用DeepSeek模型
   - 生成个性化的预测和建议
   - 支持三种预测类型的专门分析

4. **结果展示与管理**
   - 清晰的预测结果展示
   - 支持结果导出和分享
   - 历史预测记录查看和管理
   - 预测报告生成和下载

### 辅助功能

1. **历史记录管理**
   - 保存用户的预测历史（会话级别）
   - 支持历史记录查看、删除和完整报告查看
   - 预测记录摘要展示

2. **结果导出与分享**
   - 支持预测结果的完整报告导出
   - 提供结果分享功能
   - 生成可分享的预测摘要

3. **系统监控与状态**
   - 实时服务状态监控
   - API连接状态检查
   - 系统信息和版本显示

4. **用户体验优化**
   - 响应式界面设计，支持多设备访问
   - 分级下拉框选择，省市联动
   - 加载状态提示和进度显示
   - 完善的错误处理和用户反馈
   - 美观的界面样式和交互效果

## 技术实现架构

### 系统架构

1. **前端界面层**
   - Streamlit Web应用框架
   - 响应式设计和现代化UI
   - 分级下拉框和表单验证

2. **业务服务层**
   - 预测服务（prediction_service.py）
   - 八字数据服务（bazi_service.py）
   - 数据验证和处理

3. **外部API集成**
   - 缘分居国学API客户端
   - DeepSeek大语言模型API
   - 多LLM提供商支持

4. **数据模型层**
   - 用户信息模型（user_info.py）
   - 八字数据模型（bazi_data.py）
   - 预测结果模型（prediction_result.py）

### 数据处理流程

1. **用户信息收集**
   - 表单数据验证和标准化
   - 出生地点省市联动选择
   - 出生时间精确到分钟

2. **八字数据获取**
   - 调用缘分居国学API
   - 获取专业八字分析数据
   - API响应解析和验证

3. **AI预测生成**
   - 基于八字数据构建提示词
   - 调用DeepSeek模型生成预测
   - 支持多种预测类型的专门分析

4. **结果展示处理**
   - 预测结果格式化和美化
   - 历史记录保存和管理
   - 报告导出和分享功能

### 配置管理

1. **环境配置**
   - API密钥和端点配置
   - LLM提供商和模型参数
   - 系统调试和日志级别

2. **提示词配置**
   - 综合运势分析提示词
   - 事业发展分析提示词
   - 感情婚姻分析提示词
   - 商业运势分析提示词

3. **数据配置**
   - 省市数据（province.json）
   - 系统设置和参数
   - 日志配置和输出

## AI八字分析标准化流程


首先需建立精确的时空坐标：

1. **时空校正**
   - 将出生时间转换为出生地真太阳时（例：北京时间22:00在东经116°的北京仍属亥时，但若在东经87°的新疆则校正为戌时），
   - 年柱以立春为界（如2025年2月4日前后分属甲辰/乙巳年），
   - 月柱按节气切换（如7月7日小暑后为癸未月，此前属壬午月），
   - 日柱通过公历日期计算，时柱依校正后时辰确定。
2. **命盘建模**
   - 以日干为坐标原点标注十神（如日主庚金见乙木为正财、癸水为伤官），
   - 分解地支藏干（如未含己土、丁火、乙木余气），
   - 搭建四柱干支全息结构（例：乙巳 癸未 庚寅 丁亥）。
3. **能量场评估**
   - 三维量化日主强弱：
     - **得令**（月令未土不生金→失令），
     - **得地**（日支寅木为金之绝地→失地），
     - **得势**（天干仅庚金孤立→偏弱），
   - 识别调候关键（此造夏月火旺需癸亥水制衡）。
4. **动态推演**
   - 据年干阴阳与性别排大运（乙阴年男性→逆排）：
     - 计算出生日至最近逆节气天数×10（本例3岁8个月起运），
     - 大运轨迹：壬午（2029-2039）→辛巳（2039-2049）...
   - 流年作用：
     - 2025乙巳年，乙木正财合日主引动财星，巳火官杀加剧压力。
5. **格局论断**
   - 十神组合深读（如月柱癸水伤官驾时柱丁火正官，形成"伤官制杀"潜在格局），
   - 五行制化关键（需亥水调候通关方成贵气），
   - 神煞辅助（日坐天乙贵人主逢凶化吉，时柱驿马应中年奔波）。

**原则强调**

- 动态平衡：大运流年如气候变量，需叠加原局判吉凶（如壬午运水盖头克火为吉）；
- 主次层级：用神（水）>喜神（土金）>忌神（火木）；
- 客观边界：所有推论须基于节气数据库与真太阳时算法，避免主观臆断。

## 非功能性需求

### 性能要求

- **页面加载时间**：应用启动和页面加载时间不超过3秒
- **API响应时间**：缘分居国学API调用响应时间不超过10秒
- **AI生成时间**：DeepSeek模型预测生成时间不超过30秒
- **界面交互**：用户界面交互响应时间不超过1秒
- **并发支持**：支持单用户使用（Demo版本），预留多用户扩展接口

### 可用性要求

- **界面友好**：现代化、美观的用户界面设计
- **操作简单**：直观的表单设计和分级选择
- **错误处理**：完善的错误提示和异常处理机制
- **状态反馈**：清晰的加载状态和进度提示
- **帮助信息**：详细的字段说明和使用指导

### 兼容性要求

- **浏览器支持**：主流浏览器（Chrome、Firefox、Safari、Edge）
- **设备适配**：响应式设计，支持桌面端和移动端
- **Python版本**：Python 3.8+
- **依赖管理**：明确的依赖包版本和兼容性

### 安全性要求

- **数据保护**：用户输入数据不进行持久化存储
- **输入验证**：严格的数据验证和安全检查
- **API安全**：安全的API密钥管理和调用
- **隐私保护**：用户数据脱敏和安全传输
- **错误日志**：敏感信息过滤的日志记录

### 可维护性要求

- **代码结构**：清晰的模块化架构设计
- **配置管理**：灵活的环境配置和参数设置
- **日志系统**：完善的日志记录和监控
- **文档完整**：详细的技术文档和使用说明
- **扩展性**：支持新功能和API的扩展

## 用户角色和使用场景

### 目标用户

- 对玄学文化感兴趣的普通用户
- 希望体验AI预测功能的技术爱好者
- 寻求生活指导和建议的个人用户

### 使用场景

1. **个人运势查询**
   - 用户输入个人信息，查询整体运势
   - 获得关于事业、感情、健康等方面的预测

2. **特定问题咨询**
   - 用户针对具体问题寻求指导
   - 系统提供个性化的建议和预测

3. **娱乐体验**
   - 用户出于好奇心体验AI预测功能
   - 获得有趣的预测结果和建议

## 业务规则

### 输入限制

- 姓名长度：2-20个字符
- 出生日期：1900年至当前年份
- 问题描述：最多500字符
- 单次会话时间：最长30分钟

### 输出规范

- 预测结果长度：200-1000字符
- 内容积极正面，避免负面暗示
- 提供建设性建议和指导
- 包含免责声明

### 使用限制

- 每个用户每日最多10次预测
- 系统仅供娱乐参考，不承担任何责任
- 禁止用于商业用途或重大决策依据

## 项目约束

### 技术约束

- 使用Streamlit作为前端框架
- 使用LangChain作为后端框架
- 调用DeepSeek R1模型进行预测
- 不使用复杂的后端数据库
- 不需要用户身份验证系统

### 时间约束

- 项目开发周期：4周
- 每周一个里程碑节点
- 最终交付完整可运行的Demo

### 资源约束

- 单人开发项目
- 有限的API调用额度
- 本地开发和测试环境

## 验收标准

### 功能验收

- 用户能够成功输入个人信息
- 系统能够生成合理的预测结果
- 界面交互流畅，无明显bug
- 错误处理机制完善

### 性能验收

- 满足响应时间要求
- 系统稳定运行，无崩溃
- 内存使用合理，无内存泄漏

### 用户体验验收

- 界面美观，操作直观
- 提示信息清晰友好
- 预测结果易于理解
- 整体体验流畅自然

## 风险识别

### 技术风险

- AI模型API稳定性和可用性
- 模型输出质量和一致性
- 第三方依赖库兼容性问题

### 业务风险

- 用户接受度和满意度
- 预测内容的合规性
- 系统性能和稳定性

### 法律风险

- 预测内容的法律责任
- 用户隐私保护
- 迷信内容的社会影响

## 后续规划

### 功能扩展

- 支持多种预测算法
- 增加历史预测记录
- 添加用户反馈机制

### 技术升级

- 多模型集成和对比
- 移动端应用开发
- 云端部署和扩展

---

**注意**: 本系统仅供娱乐和技术演示使用，预测结果不具有科学依据，请勿用于重要决策。